============================================================
ğŸ¦ MOCK PAYMENT GATEWAY API - USAGE REFERENCE (cURL Examples)
Base URL: http://127.0.0.1:8000
Notes: Local development/testing phase
============================================================

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1ï¸âƒ£  GET /api/v1/status
Description: Check API status
Authentication: None (public)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

curl -X GET "http://127.0.0.1:8000/api/v1/status"

Sample Response:
{
    "status": "ok",
    "service": "Mock Payment Gateway",
    "version": "v1.0.0",
    "message": "All systems operational.",
    "metrics": {
        "totalTransactions": 42,
        "lastRestart": "2025-11-05T10:45:00Z"
    }
}

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
2ï¸âƒ£  POST /api/v1/users/register
Description: Register a new user (role="user")
Authentication: None
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

curl -X POST "http://127.0.0.1:8000/api/v1/users/register" \
-H "Content-Type: application/json" \
-d '{
    "name": "Alice User",
    "email": "alice@example.com",
    "password": "Password123!"
}'

Sample Response:
{
    "message": "User registered successfully.",
    "userId": "user_1a2b3c4d5e6f",
    "apiKey": "PK_LIVE_1A2B3C4D5E6F7G8H",
    "webhookSecret": "SK_9A8B7C6D5E4F3G2H1I0J",
    "role": "user",
    "createdAt": "2025-11-05T10:45:00Z"
}

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
3ï¸âƒ£  POST /api/v1/users/login
Description: Authenticate user and receive JWT token
Authentication: None
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

# Login as regular user
curl -X POST "http://127.0.0.1:8000/api/v1/users/login" \
-H "Content-Type: application/json" \
-d '{
    "email": "alice@example.com",
    "password": "Password123!"
}'

# Login as system_admin
curl -X POST "http://127.0.0.1:8000/api/v1/users/login" \
-H "Content-Type: application/json" \
-d '{
    "email": "admin@system.local",
    "password": "Admin@123!"
}'

Sample Response:
{
    "access_token": "<JWT_TOKEN_HERE>",
    "token_type": "bearer",
    "userId": "user_abcd1234",
    "role": "user"   # or "system_admin"
}

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
4ï¸âƒ£  PATCH /api/v1/users/{user_id}/role
Description: Update a user's role (only system_admin)
Authentication: JWT bearer token
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

curl -X PATCH "http://127.0.0.1:8000/api/v1/users/{user_id}/role" \
-H "Authorization: Bearer <SYSTEM_ADMIN_JWT>" \
-H "Content-Type: application/json" \
-d '{
    "new_role": "merchant"
}'

Sample Response:
{
    "message":"User role updated to 'ValidRoles.admin'",
    "userId":"user_f9ac33158ac8"
}

Notes:
- Allowed roles: user, merchant, admin
- Only system_admin can perform this operation
- Regular users or admins attempting this will get 403 Forbidden

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
5ï¸âƒ£  GET /api/v1/protected
Description: Protected route (any authenticated user)
Authentication: JWT bearer token
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

curl -X GET "http://127.0.0.1:8000/api/v1/protected" \
-H "Authorization: Bearer <JWT_TOKEN>"

Sample Response:
{
    "message": "Access granted â€” authenticated user.",
    "userId": "user_1a2b3c4d5e6f",
    "role": "user"
}

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
6ï¸âƒ£  GET /api/v1/admin/dashboard
Description: Admin-only dashboard
Authentication: JWT bearer token. Allowed roles: ('admin', 'system_admin')
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

curl -X GET "http://127.0.0.1:8000/api/v1/admin/dashboard" \
-H "Authorization: Bearer <ADMIN_JWT>"

Sample Response:
{
    "message": "Welcome to the admin dashboard.",
    "userId": "user_abcd1234",
    "role": "admin"
}

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
7ï¸âƒ£  POST /api/v1/payments/charge
Description: Create a new payment transaction
Authentication: X-API-Key header
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

curl -X POST "http://127.0.0.1:8000/api/v1/payments/charge" \
-H "X-API-Key: PK_LIVE_1A2B3C4D5E6F7G8H" \
-H "Content-Type: application/json" \
-d '{
    "customerName": "Bob Customer",
    "paymentAmount": 100.50,
    "currency": "USD",
    "details": "Payment for order #123",
    "webhookUrl": "https://webhook-test.com/05a8b87b72a379e33c1dad6777d2b70e" # live webhook URL
}'

Sample Response:
{
    "id": "txn_abcd1234",
    "customerName": "Bob Customer",
    "amount": 100.50,
    "currency": "USD",
    "status": "pending",
    "created": "2025-11-05T10:50:00Z"
}

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
8ï¸âƒ£  GET /api/v1/payments/all
Description: Retrieve all payments for the user
Authentication: X-API-Key header
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

curl -X GET "http://127.0.0.1:8000/api/v1/payments/all" \
-H "X-API-Key: PK_LIVE_1A2B3C4D5E6F7G8H"

Sample Response:
{
  "userId": "user_99e3f6242bce",
  "totalTransactions": 1,
  "transactions": [
    {
      "id": "txn_831e7dbaeadb",
      "ownerId": "user_99e3f6242bce",
      "customerName": "Falcon Project",
      "amount": 1900.5,
      "currency": "USD",
      "details": "Payment for order #123",
      "status": "completed",
      "webhookUrl": "https://webhook-test.com/05a8b87b72a379e33c1dad6777d2b70e",
      "createdAt": "2025-11-06T11:13:58.910515Z"
    }
  ]
}

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
9ï¸âƒ£  POST /api/v1/webhook-receive
Description: Receives incoming webhooks and validates HMAC signature
Authentication: X-API-Key + X-Signature
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

curl -X POST "http://127.0.0.1:8000/api/v1/webhook-receive"

  1. Run generate_curl.py file, provide required data
  2. The terminal output will display the ready to send cURL payload
  3. Send the cURL payload, evaluate the reponse


Sample Response:
{
    "status": "verified"
}

Notes:
-Run generate_curl.py  file.
It does the following:
Pulls the webhookSecret from MongoDB for the selected user (or the system_admin by default).
Generates a JSON payload (e.g., a payment.completed event).
Uses the secret to create an HMAC SHA-256 signature of that payload.
Prints a ready-to-use curl command that includes:
the JSON payload (-d '...')
User's X-API-Key
Generated X-Signature
This signature is your proof of authenticity that the webhook was generated by your system.

______________________________________

10ï¸âƒ£ DELETE /api/v1/{resource}/{resource_id}
Description: Delete a transaction or user. Transactions can be deleted by their owner or by system_admin/admin. Users can only be deleted by system_admin/admin. Self-deletion is not allowed.
Authentication: JWT required (user for own transactions, system_admin or admin for any user/transaction)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Delete a transaction owned by a user (user or system_admin)

curl -X DELETE "http://127.0.0.1:8000/api/v1/transactions/{transaction_id}" \
-H "Authorization: Bearer <USER_JWT>"

# Delete a user (system_admin or admin only)

curl -X DELETE "http://127.0.0.1:8000/api/v1/users/{user_id}" \
-H "Authorization: Bearer <SYSTEM_ADMIN_JWT>"



â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1ï¸âƒ£1ï¸âƒ£ GET /api/v1/payments/query
Description: Retrieve user transactions with optional filtering and sorting
Authentication: X-API-Key header, JWT bearer token (any authenticated user)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

# Get all transactions for authenticated user

curl -X GET "http://127.0.0.1:8000/api/v1/payments/query" \
-H "X-API-Key: USER_API_KEY" \
-H "Authorization: Bearer <USER_JWT>"

# Filter transactions by minimum and maximum amount as query parameters

curl -X GET "http://127.0.0.1:8000/api/v1/payments/query?minAmount=100&maxAmount=500" \
-H "X-API-Key: USER_API_KEY" \
-H "Authorization: Bearer <USER_JWT>"

# Sort transactions by field and order as query parameters

curl -X GET "http://127.0.0.1:8000/api/v1/payments/query?sortBy=amount&sortOrder=asc" \
-H "X-API-Key: USER_API_KEY" \
-H "Authorization: Bearer <USER_JWT>"

# Sample Response:

{
    "userId": "user_99e3f6242bce",
    "totalTransactions": 2,
    "transactions": [
        {
            "id": "txn_1a2b3c4d5e6f",
            "ownerId": "user_99e3f6242bce",
            "customerName": "Bob Customer",
            "amount": 150.75,
            "currency": "USD",
            "details": "Payment for order #451",
            "status": "completed",
            "createdAt": "2025-11-06T11:13:58.910515Z"
        },
        {
            "id": "txn_7e8f9a0b1c2d",
            "ownerId": "user_99e3f6242bce",
            "customerName": "Alice Vendor",
            "amount": 300.25,
            "currency": "USD",
            "details": "Refund for order #552",
            "status": "pending",
            "createdAt": "2025-11-07T09:15:12.110215Z"
        }
    ]
}


Notes:

Filters:
minAmount: Minimum payment amount to include
maxAmount: Maximum payment amount to include
Sorting:
sortBy: Field to sort results by (createdAt, amount, etc.)
sortOrder: Either asc (ascending) or desc (descending)
If no transactions match the filters, returns 404 Not Found.
Designed for user-level access â€” each user only sees their own transactions.
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
